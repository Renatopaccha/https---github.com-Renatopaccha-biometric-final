import{j as e,r as n}from"./ui-vendor-xpyfA3yl.js";import{c as C,P as O,S as D,u as L}from"./index-XlQLm-C3.js";import{M as $,l as q,g as U,d as V,s as B}from"./ai-jbzg6KLr.js";import{T as W,C as G,L as K,X as Y}from"./x-ITKr06nK.js";import{M as X}from"./markdown-vendor-CznH_dNw.js";import"./react-vendor-CGW8ol1_.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],J=C("bot",Z);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],ee=C("file",Q);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],te=C("image",se);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],re=C("paperclip",ae);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],le=C("send",ne);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ie=C("user",oe);function ce({sessions:s,onNewChat:a,onSelectChat:l,onDeleteChat:o,activeChatId:r}){const x=(t,h)=>{h.stopPropagation(),confirm("¬øEst√°s seguro de que deseas eliminar esta conversaci√≥n?")&&o(t)},g=t=>{try{const h=new Date(t),u=new Date().getTime()-h.getTime(),b=Math.floor(u/6e4),v=Math.floor(u/36e5),N=Math.floor(u/864e5);return b<1?"ahora mismo":b<60?`hace ${b} min`:v<24?`hace ${v}h`:N===1?"ayer":N<7?`hace ${N} d√≠as`:h.toLocaleDateString("es-ES",{month:"short",day:"numeric"})}catch{return t}};return e.jsxs("div",{className:"w-full h-full bg-white border-r border-slate-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-slate-200",children:e.jsxs("button",{onClick:a,className:"w-full px-4 py-3 bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 text-white rounded-lg font-medium text-sm flex items-center justify-center gap-2 shadow-sm transition-all",style:{fontFamily:"Inter, system-ui, sans-serif"},children:[e.jsx(O,{className:"w-5 h-5"}),"Nuevo Chat"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3",children:[e.jsx("div",{className:"mb-2 px-3",children:e.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",style:{fontFamily:"Inter, system-ui, sans-serif"},children:"Historial"})}),s.length===0?e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsx($,{className:"w-12 h-12 mx-auto text-slate-300 mb-3"}),e.jsx("p",{className:"text-sm text-slate-500",style:{fontFamily:"Inter, system-ui, sans-serif"},children:"No hay conversaciones a√∫n"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",style:{fontFamily:"Inter, system-ui, sans-serif"},children:"Crea una nueva para empezar"})]}):e.jsx("div",{className:"space-y-1",children:s.map(t=>e.jsxs("div",{onClick:()=>l(t.id),className:`group relative px-3 py-3 rounded-lg cursor-pointer transition-all ${r===t.id?"bg-teal-50 border border-teal-200":"hover:bg-slate-50 border border-transparent"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:`w-4 h-4 mt-0.5 flex-shrink-0 ${r===t.id?"text-teal-600":"text-slate-400"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium truncate ${r===t.id?"text-teal-900":"text-slate-900"}`,style:{fontFamily:"Inter, system-ui, sans-serif"},children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("p",{className:"text-xs text-slate-500",style:{fontFamily:"Inter, system-ui, sans-serif"},children:g(t.timestamp)}),t.message_count>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-slate-300",children:"‚Ä¢"}),e.jsxs("p",{className:"text-xs text-slate-500",style:{fontFamily:"Inter, system-ui, sans-serif"},children:[t.message_count," ",t.message_count===1?"mensaje":"mensajes"]})]})]})]})]}),e.jsx("div",{className:"absolute right-2 top-3 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:h=>x(t.id,h),className:"p-1.5 hover:bg-red-100 rounded text-red-600",title:"Eliminar conversaci√≥n",children:e.jsx(W,{className:"w-3.5 h-3.5"})})})]},t.id))})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 bg-slate-50",children:e.jsx("p",{className:"text-xs text-slate-600 leading-relaxed",style:{fontFamily:"Inter, system-ui, sans-serif"},children:s.length===0?"Sin conversaciones guardadas":e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:s.length})," ",s.length===1?"conversaci√≥n guardada":"conversaciones guardadas"]})})})]})}const E=[{id:"gemini-pro",name:"Gemini Pro",description:"R√°pido y vers√°til"},{id:"gemini-pro-vision",name:"Gemini Pro Vision",description:"An√°lisis de im√°genes"},{id:"gemini-ultra",name:"Gemini Ultra",description:"M√°ximo rendimiento"}];function de({chatTitle:s,selectedModel:a,onModelChange:l}){const[o,r]=n.useState(!1),x=n.useRef(null);n.useEffect(()=>{const t=h=>{x.current&&!x.current.contains(h.target)&&r(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const g=E.find(t=>t.id===a)||E[0];return e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-1 h-6 bg-gradient-to-b from-teal-500 to-teal-600 rounded-full"}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 tracking-tight",style:{fontFamily:"Inter, system-ui, sans-serif"},children:s})]}),e.jsxs("div",{className:"relative",ref:x,children:[e.jsxs("button",{onClick:()=>r(!o),className:"px-4 py-2.5 bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-lg hover:from-purple-100 hover:to-indigo-100 transition-all flex items-center gap-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-bold text-purple-900",style:{fontFamily:"Inter, system-ui, sans-serif"},children:g.name}),e.jsx("p",{className:"text-xs text-purple-700",style:{fontFamily:"Inter, system-ui, sans-serif"},children:g.description})]})]}),e.jsx(G,{className:"w-4 h-4 text-purple-600"})]}),o&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 bg-white border border-slate-300 rounded-lg shadow-xl z-20 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200",children:e.jsx("p",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",style:{fontFamily:"Inter, system-ui, sans-serif"},children:"Seleccionar Modelo de IA"})}),E.map(t=>e.jsx("button",{onClick:()=>{l(t.id),r(!1)},className:`w-full text-left px-4 py-3 hover:bg-purple-50 transition-colors border-b border-slate-100 last:border-b-0 ${a===t.id?"bg-purple-50":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:`w-4 h-4 mt-0.5 ${a===t.id?"text-purple-600":"text-slate-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-bold ${a===t.id?"text-purple-900":"text-slate-900"}`,style:{fontFamily:"Inter, system-ui, sans-serif"},children:t.name}),e.jsx("p",{className:"text-xs text-slate-600 mt-0.5",style:{fontFamily:"Inter, system-ui, sans-serif"},children:t.description})]}),a===t.id&&e.jsx("div",{className:"w-2 h-2 bg-purple-600 rounded-full mt-1.5"})]})},t.id))]})]})]})})}const me={code({node:s,inline:a,className:l,children:o,...r}){const x=/language-(\w+)/.exec(l||"");return a?e.jsx("span",{className:"bg-slate-100 text-slate-800 px-1.5 py-0.5 rounded-md font-mono text-xs font-semibold border border-slate-200",...r,children:o}):e.jsxs("div",{className:"relative my-4 rounded-lg border border-slate-200 bg-slate-50 p-4 font-mono text-sm text-slate-800 shadow-sm overflow-x-auto",children:[x&&e.jsx("div",{className:"absolute top-0 right-0 px-2 py-1 text-[10px] uppercase text-slate-400 font-bold select-none",children:x[1]}),e.jsx("pre",{className:"m-0 bg-transparent p-0",children:e.jsx("code",{className:l,...r,children:o})})]})},ul:({children:s})=>e.jsx("ul",{className:"list-disc pl-4 space-y-1 my-2",children:s}),ol:({children:s})=>e.jsx("ol",{className:"list-decimal pl-4 space-y-1 my-2",children:s}),p:({children:s})=>e.jsx("p",{className:"mb-2 last:mb-0 leading-relaxed",children:s}),strong:({children:s})=>e.jsx("strong",{className:"font-bold text-slate-900",children:s}),table:({children:s})=>e.jsx("div",{className:"overflow-x-auto my-3",children:e.jsx("table",{className:"min-w-full border-collapse border border-slate-300 text-xs",children:s})}),th:({children:s})=>e.jsx("th",{className:"border border-slate-300 px-3 py-2 bg-slate-100 text-left font-bold",children:s}),td:({children:s})=>e.jsx("td",{className:"border border-slate-300 px-3 py-2",children:s})},A={fontFamily:"Inter, system-ui, sans-serif"};function xe({message:s}){const a=s.role==="user";return e.jsxs("div",{className:`flex gap-4 mb-6 ${a?"justify-end":"justify-start"}`,children:[!a&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-sm",children:e.jsx(J,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:`max-w-[70%] ${a?"order-first":""}`,children:[e.jsx("div",{className:`rounded-2xl px-5 py-3.5 shadow-sm ${a?"bg-gradient-to-br from-teal-500 to-teal-600 text-white":"bg-white border border-slate-200 text-slate-900"}`,children:a?e.jsx("p",{className:"text-sm leading-relaxed",style:A,children:s.content}):e.jsx("div",{className:"prose prose-slate max-w-none text-sm dark:prose-invert break-words",children:e.jsx(X,{components:me,children:s.content})})}),e.jsx("p",{className:`text-xs text-slate-500 mt-1.5 ${a?"text-right":"text-left"}`,style:A,children:s.timestamp})]}),a&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-slate-600 to-slate-700 flex items-center justify-center shadow-sm",children:e.jsx(ie,{className:"w-5 h-5 text-white"})})]})}const he=n.memo(xe),k={fontFamily:"Inter, system-ui, sans-serif"};function ue({messages:s,isLoading:a=!1}){const l=n.useRef(null),o=()=>{l.current?.scrollIntoView({behavior:"smooth"})};return n.useEffect(()=>{o()},[s,a]),s.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-100 to-indigo-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",style:k,children:"Asistente AI de An√°lisis"}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4",style:k,children:"Haz preguntas sobre tus datos biom√©dicos, sube archivos CSV o im√°genes de gr√°ficos para an√°lisis, o solicita ayuda con interpretaci√≥n estad√≠stica."}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx("span",{className:"px-3 py-1.5 bg-slate-100 text-slate-700 rounded-full text-xs font-medium",style:k,children:"An√°lisis estad√≠stico"}),e.jsx("span",{className:"px-3 py-1.5 bg-slate-100 text-slate-700 rounded-full text-xs font-medium",style:k,children:"Interpretaci√≥n de resultados"}),e.jsx("span",{className:"px-3 py-1.5 bg-slate-100 text-slate-700 rounded-full text-xs font-medium",style:k,children:"Sugerencias de pruebas"})]})]})}):e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.map(r=>e.jsx(he,{message:r},r.id)),a&&e.jsxs("div",{className:"flex gap-4 mb-6 justify-start",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-sm",children:e.jsx(K,{className:"w-5 h-5 text-white animate-spin"})}),e.jsx("div",{className:"max-w-[70%]",children:e.jsx("div",{className:"rounded-2xl px-5 py-3.5 bg-white border border-slate-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}}),e.jsx("span",{className:"text-xs text-slate-600 ml-2",style:k,children:"Pensando..."})]})})})]}),e.jsx("div",{ref:l})]})})}const fe=n.memo(ue);function pe({onSendMessage:s,disabled:a=!1}){const[l,o]=n.useState(""),[r,x]=n.useState([]),g=n.useRef(null),t=n.useRef(null),h=()=>{(l.trim()||r.length>0)&&(s(l.trim(),r.length>0?r:void 0),o(""),x([]),t.current&&(t.current.style.height="auto"))},S=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),h())},u=i=>{if(i.target.files&&i.target.files.length>0){const d=Array.from(i.target.files);x(f=>[...f,...d])}},b=i=>{x(d=>d.filter((f,w)=>w!==i))},v=i=>{o(i.target.value),i.target.style.height="auto",i.target.style.height=`${Math.min(i.target.scrollHeight,150)}px`},N=i=>i.type.startsWith("image/")?e.jsx(te,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"});return e.jsx("div",{className:"bg-white border-t border-slate-200 p-4 shadow-lg",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[r.length>0&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:r.map((i,d)=>e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-2 bg-slate-100 border border-slate-300 rounded-lg text-sm",children:[e.jsx("div",{className:"text-slate-600",children:N(i)}),e.jsx("span",{className:"text-slate-900 max-w-[200px] truncate",style:{fontFamily:"Inter, system-ui, sans-serif"},children:i.name}),e.jsx("button",{onClick:()=>b(d),className:"text-slate-500 hover:text-red-600 transition-colors",children:e.jsx(Y,{className:"w-4 h-4"})})]},d))}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{onClick:()=>g.current?.click(),disabled:a,className:"flex-shrink-0 p-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Adjuntar archivo (Word, Excel, im√°genes)",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsx("input",{ref:g,type:"file",multiple:!0,accept:".docx,.xlsx,.xls,.csv,.pdf,.png,.jpg,.jpeg",onChange:u,className:"hidden"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:t,value:l,onChange:v,onKeyDown:S,disabled:a,placeholder:"Escribe tu pregunta o describe el an√°lisis que necesitas...",className:"w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",style:{fontFamily:"Inter, system-ui, sans-serif",minHeight:"52px",maxHeight:"150px"},rows:1}),l.length>0&&e.jsx("div",{className:"absolute bottom-2 right-3 text-xs text-slate-400",style:{fontFamily:"Inter, system-ui, sans-serif"},children:l.length})]}),e.jsx("button",{onClick:h,disabled:a||!l.trim()&&r.length===0,className:"flex-shrink-0 p-3 bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 text-white rounded-lg transition-all shadow-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:from-slate-300 disabled:to-slate-400",title:"Enviar mensaje (Enter)",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-slate-500",style:{fontFamily:"Inter, system-ui, sans-serif"},children:[e.jsxs("span",{children:["Presiona ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-slate-100 border border-slate-300 rounded text-slate-700 font-mono",children:"Enter"})," para enviar,",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-slate-100 border border-slate-300 rounded text-slate-700 font-mono ml-1",children:"Shift + Enter"})," para nueva l√≠nea"]}),e.jsx("span",{className:"text-slate-400",children:"Archivos soportados: Word (.docx), Excel (.xlsx/.xls), CSV (.csv), PDF (.pdf), Im√°genes (.png/.jpg)"})]})]})})}function ge(){const{sessionId:s}=L(),[a,l]=n.useState([]),[o,r]=n.useState(null),[x,g]=n.useState([]),[t,h]=n.useState(!1),[S,u]=n.useState(null),[b,v]=n.useState(null),[N,i]=n.useState(()=>typeof window<"u"?localStorage.getItem("biometric_chat_session_id"):null),d=s||N;n.useEffect(()=>{if(!d&&typeof window<"u"){const c=crypto.randomUUID();localStorage.setItem("biometric_chat_session_id",c),i(c),console.log("[useAIChat] Generated new chat session:",c)}},[d]);const f=n.useRef(a);n.useEffect(()=>{f.current=a},[a]);const w=n.useCallback(async()=>{if(!d){g([]);return}try{const c=await q(d);g(c)}catch(c){console.error("Failed to load chat sessions:",c)}},[d]);n.useEffect(()=>{w()},[w]);const H=n.useCallback(async c=>{if(d)try{const p=await U(d,c);if(p){const M=p.messages.map((m,y)=>({...m,id:`${c}-${y}`}));l(M),r(c),u(null)}}catch(p){console.error("Failed to load chat history:",p),u("No se pudo cargar el historial del chat")}},[d]),F=n.useCallback(()=>{l([]),r(null),u(null),v(null)},[]),R=n.useCallback(async c=>{if(d)try{await V(d,c)&&(g(M=>M.filter(m=>m.id!==c)),o===c&&F())}catch(p){console.error("Failed to delete chat:",p)}},[d,o,F]),_=n.useCallback(async(c,p)=>{if(!c.trim()&&(!p||p.length===0))return;v({content:c,files:p}),u(null);const M={id:Date.now().toString(),role:"user",content:p&&p.length>0?`${c}

üìé Archivos adjuntos: ${p.map(m=>m.name).join(", ")}`:c,timestamp:new Date().toISOString()};l(m=>[...m,M]),h(!0);try{const m=f.current.map(j=>({role:j.role,content:j.content,timestamp:j.timestamp})),y=await B({message:c,session_id:d||void 0,chat_id:o||void 0,history:m,files:p});if(y.success){y.chat_id&&!o&&r(y.chat_id);const j={id:(Date.now()+1).toString(),role:"assistant",content:y.response,timestamp:new Date().toISOString()};l(I=>[...I,j]),d&&w(),y.session_context_used&&console.log("‚úÖ AI used session context from dataset"),y.files_processed>0&&console.log(`‚úÖ Processed ${y.files_processed} file(s)`)}else{u(y.error||"Error desconocido");const j={id:(Date.now()+1).toString(),role:"assistant",content:y.response,timestamp:new Date().toISOString()};l(I=>[...I,j])}}catch(m){const y=m instanceof Error?m.message:"Error de conexi√≥n";u(y);let j="‚ùå No se pudo procesar tu mensaje. Por favor, verifica tu conexi√≥n e intenta nuevamente.";m instanceof Error&&(m.name==="TimeoutError"||m.message.includes("timeout")||m.message.includes("aborted")?j="‚è±Ô∏è La IA est√° tomando m√°s tiempo de lo esperado. Intenta reformular tu pregunta o dividirla en partes m√°s peque√±as.":(m.message.includes("fetch")||m.message.includes("network")||m.message.includes("conexi√≥n"))&&(j="üåê Error de conexi√≥n. Por favor, verifica tu conexi√≥n a internet e intenta nuevamente."));const I={id:(Date.now()+1).toString(),role:"assistant",content:j,timestamp:new Date().toISOString()};l(z=>[...z,I])}finally{h(!1)}},[d,o,w]),P=n.useCallback(async()=>{b&&(l(c=>c.slice(0,-2)),await _(b.content,b.files))},[b,_]),T=n.useCallback(()=>{l([]),r(null),u(null),v(null)},[]);return{messages:a,chatId:o,chatSessions:x,isLoading:t,error:S,sendMessage:_,clearChat:T,retryLastMessage:P,loadChatHistory:H,loadChatSessions:w,startNewChat:F,deleteChatSession:R}}function Se({initialChatId:s}){const{sessionId:a}=L(),{messages:l,chatId:o,chatSessions:r,isLoading:x,sendMessage:g,loadChatHistory:t,startNewChat:h,deleteChatSession:S}=ge();n.useEffect(()=>{s&&r.some(f=>f.id===s)&&o!==s&&t(s)},[s,r,o,t]);const u=()=>{h()},b=f=>{t(f)},v=f=>{S(f)},N=async(f,w)=>{await g(f,w)},i=r.find(f=>f.id===o)?.title||"Nuevo Chat";return e.jsxs("div",{className:"h-full flex bg-slate-50",children:[e.jsx("div",{className:"w-1/4 min-w-[280px] max-w-[400px]",children:e.jsx(ce,{sessions:r,onNewChat:u,onSelectChat:b,onDeleteChat:v,activeChatId:o})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(de,{chatTitle:i,selectedModel:"gemini-2.5-flash",onModelChange:()=>{}}),a&&e.jsx("div",{className:"px-6 py-2 bg-blue-50 border-b border-blue-200",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex items-center gap-2 text-sm text-blue-800",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("span",{style:{fontFamily:"Inter, system-ui, sans-serif"},children:[e.jsx("strong",{children:"Contexto activo:"})," La IA puede ver tus datos cargados y responder preguntas espec√≠ficas sobre ellos."]})]})}),e.jsx(fe,{messages:l,isLoading:x}),e.jsx(pe,{onSendMessage:N,disabled:x})]})]})}export{Se as AIAssistant};
