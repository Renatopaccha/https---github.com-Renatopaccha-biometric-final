import{r as l,j as e,R as Ot,c as zt,u as V,a as It,b as Se,P as G,d as ae,e as F,f as Q,g as Ft,h as Vt,i as Bt,k as Ut,l as Ht,m as Wt,T as qt,I as Yt,V as Xt,n as Gt,C as Jt,o as Qt,p as Kt,q as Zt,s as es,S as ts,t as ss,v as Fe,w as rs,W as as,x as ns,y as os,D as ls,z as Ve,A as is,O as cs,B as ds}from"./ui-vendor-xpyfA3yl.js";import{c as R,u as ge,D as Be,S as us}from"./index-XlQLm-C3.js";import{F as Ue,c as E,T as K,I as He,C as te,D as ms,a as xs,b as hs,d as gs,e as fs,f as ps,g as ye,h as bs}from"./dialog-Cs2yzuxU.js";import{c as vs}from"./chart-vendor-qjz1oLjx.js";import{X as re,L as q,C as Ce,T as js}from"./x-ITKr06nK.js";import"./react-vendor-CGW8ol1_.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],we=R("activity",ys);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]],$e=R("beaker",ws);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],_e=R("check",Ns);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Cs=R("chevron-left",Ss);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],We=R("chevron-up",_s);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ks=R("circle-check-big",Es);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Rs=R("columns-2",Ds);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],fe=R("copy",As);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],Ts=R("droplets",Ps);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]],Ne=R("eraser",Ls);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ms=R("file-text",$s);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],zs=R("refresh-ccw",Os);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Me=R("search",Is);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Vs=R("square-check-big",Fs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],Us=R("trending-down",Bs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Ws=R("undo-2",Hs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],Ys=R("upload",qs),Xs="http://localhost:8000",Gs=`${Xs}/api/v1`;function Js({onUploadSuccess:t}){const[s,r]=l.useState(!1),[a,n]=l.useState(!1),[o,d]=l.useState(null),u=l.useRef(null),m=async i=>{n(!0),d(null);try{const c=new FormData;c.append("file",i);const g=await fetch(`${Gs}/upload`,{method:"POST",body:c}),j=await g.text();if(!g.ok)try{const y=JSON.parse(j);throw new Error(y.detail||y.message||"Error al subir el archivo")}catch{throw console.error("Non-JSON error response:",j),new Error(`Error del servidor (${g.status}): ${g.statusText}`)}let N;try{N=JSON.parse(j)}catch{throw console.error("Non-JSON success response:",j),new Error("Respuesta inválida del servidor")}t(N)}catch(c){const g=c instanceof Error?c.message:"Error desconocido al subir archivo";d(g),console.error("Upload error:",c)}finally{n(!1)}},x=i=>{if(!i)return;const c=[".csv",".xlsx",".xls"],g="."+i.name.split(".").pop()?.toLowerCase();if(!c.includes(g)){d(`Formato no válido. Use: ${c.join(", ")}`);return}const j=50*1024*1024;if(i.size>j){d("El archivo excede el tamaño máximo de 50MB");return}m(i)},f=i=>{i.preventDefault(),r(!0)},p=()=>{r(!1)},h=i=>{i.preventDefault(),r(!1);const c=i.dataTransfer.files[0];x(c)},b=()=>{u.current?.click()},v=i=>{const c=i.target.files?.[0];x(c)};return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-8",children:e.jsx("div",{className:`border-2 border-dashed rounded-lg p-16 text-center transition-all ${s?"border-teal-500 bg-teal-50":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,onDragOver:f,onDragLeave:p,onDrop:h,children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:`w-14 h-14 rounded-full flex items-center justify-center ${a?"bg-teal-100":"bg-teal-50"}`,children:e.jsx(Ys,{className:`w-7 h-7 text-teal-600 ${a?"animate-pulse":""}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 mb-1",children:a?"Subiendo archivo...":"Importar Dataset"}),e.jsx("p",{className:"text-sm text-gray-600",children:a?"Por favor espera mientras procesamos tu archivo":"Arrastra y suelta tu archivo aquí o haz clic para seleccionar"})]}),e.jsx("input",{ref:u,type:"file",accept:".csv,.xlsx,.xls",onChange:v,className:"hidden",disabled:a}),e.jsx("button",{onClick:b,disabled:a,className:`px-5 py-2.5 rounded-md transition-colors text-sm ${a?"bg-gray-400 text-white cursor-not-allowed":"bg-teal-600 text-white hover:bg-teal-700"}`,children:a?"Procesando...":"Seleccionar Archivo"}),o&&e.jsx("div",{className:"mt-2 px-4 py-2 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-700",children:o})}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{children:"Formatos: .csv, .xlsx, .xls"})]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Tamaño máximo: 50MB"})]})]})})})}const Qs="http://localhost:8000",I=`${Qs}/api/v1`;function ne(){const[t,s]=l.useState(!1),[r,a]=l.useState(null);return{isLoading:t,error:r,fetchQualityReport:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/quality?session_id=${v}`);if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al obtener reporte de calidad")}return await i.json()}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Quality report error:",i),null}finally{s(!1)}},cleanNulls:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/nulls`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al limpiar valores nulos")}return await i.json()}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Clean nulls error:",i),null}finally{s(!1)}},simulateNullCleaning:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/nulls/simulate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al simular limpieza")}return await i.json()}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Simulation error:",i),null}finally{s(!1)}},removeDuplicates:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/duplicates`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al eliminar duplicados")}return await i.json()}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Remove duplicates error:",i),null}finally{s(!1)}},deleteRows:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/delete-rows`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al eliminar filas")}return await i.json()}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Delete rows error:",i),null}finally{s(!1)}},undoLastChange:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/undo`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:v})});if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al deshacer cambio")}return(await i.json()).success}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Undo error:",i),!1}finally{s(!1)}},filterColumns:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/filter-columns`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al filtrar columnas")}return await i.json()}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Filter columns error:",i),null}finally{s(!1)}},checkEmptyRows:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/cleaning/empty-rows?session_id=${v}`);if(!i.ok){const g=await i.json();throw new Error(g.message||"Error al detectar filas vacías")}return await i.json()}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Check empty rows error:",i),null}finally{s(!1)}},downloadDataset:async(v,i)=>{s(!0),a(null);try{const c=await fetch(`${I}/export/dataset/${v}`);if(!c.ok)throw new Error("Error al descargar el dataset");const g=await c.blob(),j=window.URL.createObjectURL(g),N=document.createElement("a");return N.href=j,N.download=`${i}_clean.xlsx`,document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(j),!0}catch(c){const g=c instanceof Error?c.message:"Error desconocido";return a(g),console.error("Download dataset error:",c),!1}finally{s(!1)}},downloadAuditReport:async v=>{s(!0),a(null);try{const i=await fetch(`${I}/export/audit-report/${v}`);if(!i.ok)throw new Error("Error al descargar el reporte de auditoría");const c=await i.blob(),j=`reporte_auditoria_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.txt`,N=window.URL.createObjectURL(c),y=document.createElement("a");return y.href=N,y.download=j,document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(N),!0}catch(i){const c=i instanceof Error?i.message:"Error desconocido";return a(c),console.error("Download audit report error:",i),!1}finally{s(!1)}}}}var Ks=Symbol.for("react.lazy"),le=Ot[" use ".trim().toString()];function Zs(t){return typeof t=="object"&&t!==null&&"then"in t}function qe(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===Ks&&"_payload"in t&&Zs(t._payload)}function Ye(t){const s=tr(t),r=l.forwardRef((a,n)=>{let{children:o,...d}=a;qe(o)&&typeof le=="function"&&(o=le(o._payload));const u=l.Children.toArray(o),m=u.find(rr);if(m){const x=m.props.children,f=u.map(p=>p===m?l.Children.count(x)>1?l.Children.only(null):l.isValidElement(x)?x.props.children:null:p);return e.jsx(s,{...d,ref:n,children:l.isValidElement(x)?l.cloneElement(x,void 0,f):null})}return e.jsx(s,{...d,ref:n,children:o})});return r.displayName=`${t}.Slot`,r}var er=Ye("Slot");function tr(t){const s=l.forwardRef((r,a)=>{let{children:n,...o}=r;if(qe(n)&&typeof le=="function"&&(n=le(n._payload)),l.isValidElement(n)){const d=nr(n),u=ar(o,n.props);return n.type!==l.Fragment&&(u.ref=a?zt(a,d):d),l.cloneElement(n,u)}return l.Children.count(n)>1?l.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var sr=Symbol("radix.slottable");function rr(t){return l.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===sr}function ar(t,s){const r={...s};for(const a in s){const n=t[a],o=s[a];/^on[A-Z]/.test(a)?n&&o?r[a]=(...u)=>{const m=o(...u);return n(...u),m}:n&&(r[a]=n):a==="style"?r[a]={...n,...o}:a==="className"&&(r[a]=[n,o].filter(Boolean).join(" "))}return{...t,...r}}function nr(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}const Oe=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,ze=vs,or=(t,s)=>r=>{var a;if(s?.variants==null)return ze(t,r?.class,r?.className);const{variants:n,defaultVariants:o}=s,d=Object.keys(n).map(x=>{const f=r?.[x],p=o?.[x];if(f===null)return null;const h=Oe(f)||Oe(p);return n[x][h]}),u=r&&Object.entries(r).reduce((x,f)=>{let[p,h]=f;return h===void 0||(x[p]=h),x},{}),m=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((x,f)=>{let{class:p,className:h,...b}=f;return Object.entries(b).every(v=>{let[i,c]=v;return Array.isArray(c)?c.includes({...o,...u}[i]):{...o,...u}[i]===c})?[...x,p,h]:x},[]);return ze(t,d,m,r?.class,r?.className)},Ee=or("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function A({className:t,variant:s,size:r,asChild:a=!1,...n}){const o=a?er:"button";return e.jsx(o,{"data-slot":"button",className:E(Ee({variant:s,size:r,className:t})),...n})}function ke({className:t,type:s,...r}){return e.jsx("input",{type:s,"data-slot":"input",className:E("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}function lr(t,s){return l.useReducer((r,a)=>s[r][a]??r,t)}var De="ScrollArea",[Xe]=Se(De),[ir,O]=Xe(De),Ge=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:n,scrollHideDelay:o=600,...d}=t,[u,m]=l.useState(null),[x,f]=l.useState(null),[p,h]=l.useState(null),[b,v]=l.useState(null),[i,c]=l.useState(null),[g,j]=l.useState(0),[N,y]=l.useState(0),[M,P]=l.useState(!1),[k,z]=l.useState(!1),C=V(s,U=>m(U)),T=It(n);return e.jsx(ir,{scope:r,type:a,dir:T,scrollHideDelay:o,scrollArea:u,viewport:x,onViewportChange:f,content:p,onContentChange:h,scrollbarX:b,onScrollbarXChange:v,scrollbarXEnabled:M,onScrollbarXEnabledChange:P,scrollbarY:i,onScrollbarYChange:c,scrollbarYEnabled:k,onScrollbarYEnabledChange:z,onCornerWidthChange:j,onCornerHeightChange:y,children:e.jsx(G.div,{dir:T,...d,ref:C,style:{position:"relative","--radix-scroll-area-corner-width":g+"px","--radix-scroll-area-corner-height":N+"px",...t.style}})})});Ge.displayName=De;var Je="ScrollAreaViewport",Qe=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:a,nonce:n,...o}=t,d=O(Je,r),u=l.useRef(null),m=V(s,u,d.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(G.div,{"data-radix-scroll-area-viewport":"",...o,ref:m,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});Qe.displayName=Je;var B="ScrollAreaScrollbar",Ke=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=O(B,t.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:d}=n,u=t.orientation==="horizontal";return l.useEffect(()=>(u?o(!0):d(!0),()=>{u?o(!1):d(!1)}),[u,o,d]),n.type==="hover"?e.jsx(cr,{...a,ref:s,forceMount:r}):n.type==="scroll"?e.jsx(dr,{...a,ref:s,forceMount:r}):n.type==="auto"?e.jsx(Ze,{...a,ref:s,forceMount:r}):n.type==="always"?e.jsx(Re,{...a,ref:s}):null});Ke.displayName=B;var cr=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=O(B,t.__scopeScrollArea),[o,d]=l.useState(!1);return l.useEffect(()=>{const u=n.scrollArea;let m=0;if(u){const x=()=>{window.clearTimeout(m),d(!0)},f=()=>{m=window.setTimeout(()=>d(!1),n.scrollHideDelay)};return u.addEventListener("pointerenter",x),u.addEventListener("pointerleave",f),()=>{window.clearTimeout(m),u.removeEventListener("pointerenter",x),u.removeEventListener("pointerleave",f)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(ae,{present:r||o,children:e.jsx(Ze,{"data-state":o?"visible":"hidden",...a,ref:s})})}),dr=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=O(B,t.__scopeScrollArea),o=t.orientation==="horizontal",d=be(()=>m("SCROLL_END"),100),[u,m]=lr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(u==="idle"){const x=window.setTimeout(()=>m("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(x)}},[u,n.scrollHideDelay,m]),l.useEffect(()=>{const x=n.viewport,f=o?"scrollLeft":"scrollTop";if(x){let p=x[f];const h=()=>{const b=x[f];p!==b&&(m("SCROLL"),d()),p=b};return x.addEventListener("scroll",h),()=>x.removeEventListener("scroll",h)}},[n.viewport,o,m,d]),e.jsx(ae,{present:r||u!=="hidden",children:e.jsx(Re,{"data-state":u==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:F(t.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:F(t.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),Ze=l.forwardRef((t,s)=>{const r=O(B,t.__scopeScrollArea),{forceMount:a,...n}=t,[o,d]=l.useState(!1),u=t.orientation==="horizontal",m=be(()=>{if(r.viewport){const x=r.viewport.offsetWidth<r.viewport.scrollWidth,f=r.viewport.offsetHeight<r.viewport.scrollHeight;d(u?x:f)}},10);return se(r.viewport,m),se(r.content,m),e.jsx(ae,{present:a||o,children:e.jsx(Re,{"data-state":o?"visible":"hidden",...n,ref:s})})}),Re=l.forwardRef((t,s)=>{const{orientation:r="vertical",...a}=t,n=O(B,t.__scopeScrollArea),o=l.useRef(null),d=l.useRef(0),[u,m]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=at(u.viewport,u.content),f={...a,sizes:u,onSizesChange:m,hasThumb:x>0&&x<1,onThumbChange:h=>o.current=h,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:h=>d.current=h};function p(h,b){return fr(h,d.current,u,b)}return r==="horizontal"?e.jsx(ur,{...f,ref:s,onThumbPositionChange:()=>{if(n.viewport&&o.current){const h=n.viewport.scrollLeft,b=Ie(h,u,n.dir);o.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=p(h,n.dir))}}):r==="vertical"?e.jsx(mr,{...f,ref:s,onThumbPositionChange:()=>{if(n.viewport&&o.current){const h=n.viewport.scrollTop,b=Ie(h,u);o.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=p(h))}}):null}),ur=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,o=O(B,t.__scopeScrollArea),[d,u]=l.useState(),m=l.useRef(null),x=V(s,m,o.onScrollbarXChange);return l.useEffect(()=>{m.current&&u(getComputedStyle(m.current))},[m]),e.jsx(tt,{"data-orientation":"horizontal",...n,ref:x,sizes:r,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":pe(r)+"px",...t.style},onThumbPointerDown:f=>t.onThumbPointerDown(f.x),onDragScroll:f=>t.onDragScroll(f.x),onWheelScroll:(f,p)=>{if(o.viewport){const h=o.viewport.scrollLeft+f.deltaX;t.onWheelScroll(h),ot(h,p)&&f.preventDefault()}},onResize:()=>{m.current&&o.viewport&&d&&a({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:ce(d.paddingLeft),paddingEnd:ce(d.paddingRight)}})}})}),mr=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,o=O(B,t.__scopeScrollArea),[d,u]=l.useState(),m=l.useRef(null),x=V(s,m,o.onScrollbarYChange);return l.useEffect(()=>{m.current&&u(getComputedStyle(m.current))},[m]),e.jsx(tt,{"data-orientation":"vertical",...n,ref:x,sizes:r,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":pe(r)+"px",...t.style},onThumbPointerDown:f=>t.onThumbPointerDown(f.y),onDragScroll:f=>t.onDragScroll(f.y),onWheelScroll:(f,p)=>{if(o.viewport){const h=o.viewport.scrollTop+f.deltaY;t.onWheelScroll(h),ot(h,p)&&f.preventDefault()}},onResize:()=>{m.current&&o.viewport&&d&&a({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:ce(d.paddingTop),paddingEnd:ce(d.paddingBottom)}})}})}),[xr,et]=Xe(B),tt=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:n,onThumbChange:o,onThumbPointerUp:d,onThumbPointerDown:u,onThumbPositionChange:m,onDragScroll:x,onWheelScroll:f,onResize:p,...h}=t,b=O(B,r),[v,i]=l.useState(null),c=V(s,C=>i(C)),g=l.useRef(null),j=l.useRef(""),N=b.viewport,y=a.content-a.viewport,M=Q(f),P=Q(m),k=be(p,10);function z(C){if(g.current){const T=C.clientX-g.current.left,U=C.clientY-g.current.top;x({x:T,y:U})}}return l.useEffect(()=>{const C=T=>{const U=T.target;v?.contains(U)&&M(T,y)};return document.addEventListener("wheel",C,{passive:!1}),()=>document.removeEventListener("wheel",C,{passive:!1})},[N,v,y,M]),l.useEffect(P,[a,P]),se(v,k),se(b.content,k),e.jsx(xr,{scope:r,scrollbar:v,hasThumb:n,onThumbChange:Q(o),onThumbPointerUp:Q(d),onThumbPositionChange:P,onThumbPointerDown:Q(u),children:e.jsx(G.div,{...h,ref:c,style:{position:"absolute",...h.style},onPointerDown:F(t.onPointerDown,C=>{C.button===0&&(C.target.setPointerCapture(C.pointerId),g.current=v.getBoundingClientRect(),j.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),z(C))}),onPointerMove:F(t.onPointerMove,z),onPointerUp:F(t.onPointerUp,C=>{const T=C.target;T.hasPointerCapture(C.pointerId)&&T.releasePointerCapture(C.pointerId),document.body.style.webkitUserSelect=j.current,b.viewport&&(b.viewport.style.scrollBehavior=""),g.current=null})})})}),ie="ScrollAreaThumb",st=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=et(ie,t.__scopeScrollArea);return e.jsx(ae,{present:r||n.hasThumb,children:e.jsx(hr,{ref:s,...a})})}),hr=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:a,...n}=t,o=O(ie,r),d=et(ie,r),{onThumbPositionChange:u}=d,m=V(s,p=>d.onThumbChange(p)),x=l.useRef(void 0),f=be(()=>{x.current&&(x.current(),x.current=void 0)},100);return l.useEffect(()=>{const p=o.viewport;if(p){const h=()=>{if(f(),!x.current){const b=pr(p,u);x.current=b,u()}};return u(),p.addEventListener("scroll",h),()=>p.removeEventListener("scroll",h)}},[o.viewport,f,u]),e.jsx(G.div,{"data-state":d.hasThumb?"visible":"hidden",...n,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:F(t.onPointerDownCapture,p=>{const b=p.target.getBoundingClientRect(),v=p.clientX-b.left,i=p.clientY-b.top;d.onThumbPointerDown({x:v,y:i})}),onPointerUp:F(t.onPointerUp,d.onThumbPointerUp)})});st.displayName=ie;var Ae="ScrollAreaCorner",rt=l.forwardRef((t,s)=>{const r=O(Ae,t.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?e.jsx(gr,{...t,ref:s}):null});rt.displayName=Ae;var gr=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,...a}=t,n=O(Ae,r),[o,d]=l.useState(0),[u,m]=l.useState(0),x=!!(o&&u);return se(n.scrollbarX,()=>{const f=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(f),m(f)}),se(n.scrollbarY,()=>{const f=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(f),d(f)}),x?e.jsx(G.div,{...a,ref:s,style:{width:o,height:u,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function ce(t){return t?parseInt(t,10):0}function at(t,s){const r=t/s;return isNaN(r)?0:r}function pe(t){const s=at(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-r)*s;return Math.max(a,18)}function fr(t,s,r,a="ltr"){const n=pe(r),o=n/2,d=s||o,u=n-d,m=r.scrollbar.paddingStart+d,x=r.scrollbar.size-r.scrollbar.paddingEnd-u,f=r.content-r.viewport,p=a==="ltr"?[0,f]:[f*-1,0];return nt([m,x],p)(t)}function Ie(t,s,r="ltr"){const a=pe(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,o=s.scrollbar.size-n,d=s.content-s.viewport,u=o-a,m=r==="ltr"?[0,d]:[d*-1,0],x=Vt(t,m);return nt([0,d],[0,u])(x)}function nt(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(t[1]-t[0]);return s[0]+a*(r-t[0])}}function ot(t,s){return t>0&&t<s}var pr=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},a=0;return(function n(){const o={left:t.scrollLeft,top:t.scrollTop},d=r.left!==o.left,u=r.top!==o.top;(d||u)&&s(),r=o,a=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(a)};function be(t,s){const r=Q(t),a=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(a.current),[]),l.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function se(t,s){const r=Q(s);Ft(()=>{let a=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return n.observe(t),()=>{window.cancelAnimationFrame(a),n.unobserve(t)}}},[t,r])}var br=Ge,vr=Qe,jr=rt;function lt({className:t,children:s,...r}){return e.jsxs(br,{"data-slot":"scroll-area",className:E("relative",t),...r,children:[e.jsx(vr,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),e.jsx(yr,{}),e.jsx(jr,{})]})}function yr({className:t,orientation:s="vertical",...r}){return e.jsx(Ke,{"data-slot":"scroll-area-scrollbar",orientation:s,className:E("flex touch-none p-px transition-colors select-none",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",t),...r,children:e.jsx(st,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var ve="Checkbox",[wr]=Se(ve),[Nr,Pe]=wr(ve);function Sr(t){const{__scopeCheckbox:s,checked:r,children:a,defaultChecked:n,disabled:o,form:d,name:u,onCheckedChange:m,required:x,value:f="on",internal_do_not_use_render:p}=t,[h,b]=Bt({prop:r,defaultProp:n??!1,onChange:m,caller:ve}),[v,i]=l.useState(null),[c,g]=l.useState(null),j=l.useRef(!1),N=v?!!d||!!v.closest("form"):!0,y={checked:h,disabled:o,setChecked:b,control:v,setControl:i,name:u,form:d,value:f,hasConsumerStoppedPropagationRef:j,required:x,defaultChecked:X(n)?!1:n,isFormControl:N,bubbleInput:c,setBubbleInput:g};return e.jsx(Nr,{scope:s,...y,children:Cr(p)?p(y):a})}var it="CheckboxTrigger",ct=l.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:r,...a},n)=>{const{control:o,value:d,disabled:u,checked:m,required:x,setControl:f,setChecked:p,hasConsumerStoppedPropagationRef:h,isFormControl:b,bubbleInput:v}=Pe(it,t),i=V(n,f),c=l.useRef(m);return l.useEffect(()=>{const g=o?.form;if(g){const j=()=>p(c.current);return g.addEventListener("reset",j),()=>g.removeEventListener("reset",j)}},[o,p]),e.jsx(G.button,{type:"button",role:"checkbox","aria-checked":X(m)?"mixed":m,"aria-required":x,"data-state":gt(m),"data-disabled":u?"":void 0,disabled:u,value:d,...a,ref:i,onKeyDown:F(s,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:F(r,g=>{p(j=>X(j)?!0:!j),v&&b&&(h.current=g.isPropagationStopped(),h.current||g.stopPropagation())})})});ct.displayName=it;var dt=l.forwardRef((t,s)=>{const{__scopeCheckbox:r,name:a,checked:n,defaultChecked:o,required:d,disabled:u,value:m,onCheckedChange:x,form:f,...p}=t;return e.jsx(Sr,{__scopeCheckbox:r,checked:n,defaultChecked:o,disabled:u,required:d,onCheckedChange:x,name:a,form:f,value:m,internal_do_not_use_render:({isFormControl:h})=>e.jsxs(e.Fragment,{children:[e.jsx(ct,{...p,ref:s,__scopeCheckbox:r}),h&&e.jsx(ht,{__scopeCheckbox:r})]})})});dt.displayName=ve;var ut="CheckboxIndicator",mt=l.forwardRef((t,s)=>{const{__scopeCheckbox:r,forceMount:a,...n}=t,o=Pe(ut,r);return e.jsx(ae,{present:a||X(o.checked)||o.checked===!0,children:e.jsx(G.span,{"data-state":gt(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...t.style}})})});mt.displayName=ut;var xt="CheckboxBubbleInput",ht=l.forwardRef(({__scopeCheckbox:t,...s},r)=>{const{control:a,hasConsumerStoppedPropagationRef:n,checked:o,defaultChecked:d,required:u,disabled:m,name:x,value:f,form:p,bubbleInput:h,setBubbleInput:b}=Pe(xt,t),v=V(r,b),i=Ut(o),c=Ht(a);l.useEffect(()=>{const j=h;if(!j)return;const N=window.HTMLInputElement.prototype,M=Object.getOwnPropertyDescriptor(N,"checked").set,P=!n.current;if(i!==o&&M){const k=new Event("click",{bubbles:P});j.indeterminate=X(o),M.call(j,X(o)?!1:o),j.dispatchEvent(k)}},[h,i,o,n]);const g=l.useRef(X(o)?!1:o);return e.jsx(G.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??g.current,required:u,disabled:m,name:x,value:f,form:p,...s,tabIndex:-1,ref:v,style:{...s.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ht.displayName=xt;function Cr(t){return typeof t=="function"}function X(t){return t==="indeterminate"}function gt(t){return X(t)?"indeterminate":t?"checked":"unchecked"}function de({className:t,...s}){return e.jsx(dt,{"data-slot":"checkbox",className:E("peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(mt,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(_e,{className:"size-3.5"})})})}function _r({isOpen:t,onClose:s,columns:r=[],sessionId:a,onSuccess:n}){const{filterColumns:o,isLoading:d}=ne(),[u,m]=l.useState(new Set),[x,f]=l.useState("");l.useEffect(()=>{t&&r.length>0&&m(new Set(r))},[t,r]);const p=l.useMemo(()=>{if(!r)return[];if(!x.trim())return r;const c=x.toLowerCase();return r.filter(g=>g.toLowerCase().includes(c))},[r,x]),h=c=>{const g=new Set(u);g.has(c)?g.delete(c):g.add(c),m(g)},b=()=>{const c=p.length>0&&p.every(j=>u.has(j)),g=new Set(u);c?p.forEach(j=>g.delete(j)):p.forEach(j=>g.add(j)),m(g)},v=async()=>{if(u.size===0){alert("Debes mantener al menos una columna");return}const c=await o({session_id:a,columns_to_keep:Array.from(u)});c&&c.success&&n()},i=p.length>0&&p.every(c=>u.has(c));return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden m-4",children:[e.jsxs("div",{className:"p-6 pb-4 border-b flex justify-between items-start bg-white",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"flex items-center gap-2 text-xl font-semibold text-gray-900",children:[e.jsx(Vs,{className:"w-5 h-5 text-teal-600"}),"Gestionar Columnas"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Desmarca las columnas que deseas eliminar de la base de datos."})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col p-6 py-4 bg-gray-50/30",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(ke,{placeholder:"Buscar variable...",value:x,onChange:c=>f(c.target.value),className:"pl-10 bg-white"})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white rounded-md border border-gray-200 mb-2 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{checked:i,onCheckedChange:b,id:"select-all"}),e.jsx("label",{htmlFor:"select-all",className:"text-sm font-medium cursor-pointer text-gray-700 select-none",children:i?"Deseleccionar Todo":"Seleccionar Todo"})]}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono bg-gray-100 px-2 py-1 rounded",children:[u.size," / ",r.length," activas"]})]}),e.jsx(lt,{className:"flex-1 border rounded-md bg-white",children:e.jsx("div",{className:"p-2 space-y-1",children:p.length>0?p.map(c=>{const g=u.has(c);return e.jsxs("div",{onClick:()=>h(c),className:`flex items-center gap-3 p-2.5 rounded-md transition-all cursor-pointer border select-none ${g?"bg-teal-50 border-teal-100":"hover:bg-gray-50 border-transparent"}`,children:[e.jsx(de,{checked:g,onCheckedChange:()=>h(c),className:"data-[state=checked]:bg-teal-600 data-[state=checked]:border-teal-600"}),e.jsx("span",{className:`text-sm flex-1 truncate ${g?"font-medium text-teal-900":"text-gray-600"}`,children:c})]},c)}):e.jsxs("div",{className:"text-center py-10 text-gray-400 flex flex-col items-center gap-2",children:[e.jsx(Me,{className:"w-8 h-8 opacity-20"}),e.jsx("p",{children:"No se encontraron columnas"})]})})})]}),e.jsxs("div",{className:"p-6 pt-4 border-t bg-gray-50 flex justify-end gap-3",children:[e.jsx(A,{variant:"outline",onClick:s,disabled:d,children:"Cancelar"}),e.jsx(A,{onClick:v,disabled:d||u.size===0,className:"bg-teal-600 hover:bg-teal-700 text-white min-w-[140px] shadow-sm",children:d?"Aplicando...":"Guardar Cambios"})]})]})}):null}function Er({isOpen:t,onClose:s,sessionId:r,onSuccess:a}){const{checkEmptyRows:n,deleteRows:o}=ne(),[d,u]=l.useState(null),[m,x]=l.useState(!1),[f,p]=l.useState(!1);l.useEffect(()=>{t&&r?h():u(null)},[t,r]);const h=async()=>{x(!0);const v=await n(r);u(v),x(!1)},b=async()=>{if(!d||d.total_empty===0)return;p(!0);const v=await o({session_id:r,row_indices:d.empty_row_indices});p(!1),v&&v.success&&(a(),s())};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[85vh] flex flex-col overflow-hidden m-4",children:[e.jsxs("div",{className:"p-6 pb-4 border-b flex justify-between items-start bg-white",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Detectar Filas Vacías"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Revisa y elimina filas completamente vacías"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col p-6 bg-gray-50/30",children:m?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-8 h-8 animate-spin text-teal-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Analizando dataset..."})]})}):d?e.jsx(e.Fragment,{children:d.total_empty===0?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"¡Dataset Limpio!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No se detectaron filas completamente vacías en tu dataset."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-4 bg-amber-50 border border-amber-200 rounded-md flex gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-amber-900 mb-1",children:["Se detectaron ",d.total_empty," fila",d.total_empty!==1?"s":""," vacía",d.total_empty!==1?"s":""]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Revisa la lista abajo antes de confirmar la eliminación. Todas las columnas están vacías en estas filas."})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Vista previa (hasta 10 filas):"}),e.jsx(lt,{className:"h-full border rounded-md bg-white",children:e.jsx("div",{className:"p-3",children:d.preview.length>0?e.jsx("div",{className:"space-y-2",children:d.preview.map((v,i)=>{const c=v.__row_index__??i;return e.jsxs("div",{className:"p-3 border border-red-100 bg-red-50/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-mono rounded",children:["Fila ",c]}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Todas las columnas vacías"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 text-xs",children:Object.entries(v).filter(([g])=>g!=="__row_index__").slice(0,6).map(([g,j])=>e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("span",{className:"font-mono text-gray-500",children:[g,":"]}),e.jsx("span",{className:"text-gray-400 italic",children:"null"})]},g))})]},i)})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay vista previa disponible"})})})]})]})}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Error al detectar filas vacías"})})}),e.jsxs("div",{className:"p-6 pt-4 border-t bg-gray-50 flex justify-end gap-3",children:[e.jsx(A,{variant:"outline",onClick:s,disabled:f,children:d?.total_empty===0?"Cerrar":"Cancelar"}),d&&d.total_empty>0&&e.jsx(A,{onClick:b,disabled:f,className:"bg-red-600 hover:bg-red-700 text-white min-w-[160px]",children:f?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}),"Eliminando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Eliminar ",d.total_empty," Fila",d.total_empty!==1?"s":""]})})]})]})}):null}function ue({...t}){return e.jsx(Wt,{"data-slot":"select",...t})}function me({...t}){return e.jsx(Xt,{"data-slot":"select-value",...t})}function xe({className:t,size:s="default",children:r,...a}){return e.jsxs(qt,{"data-slot":"select-trigger","data-size":s,className:E("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[r,e.jsx(Yt,{asChild:!0,children:e.jsx(Ce,{className:"size-4 opacity-50"})})]})}function he({className:t,children:s,position:r="popper",...a}){return e.jsx(Gt,{children:e.jsxs(Jt,{"data-slot":"select-content",className:E("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...a,children:[e.jsx(kr,{}),e.jsx(Qt,{className:E("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),e.jsx(Dr,{})]})})}function $({className:t,children:s,...r}){return e.jsxs(Kt,{"data-slot":"select-item",className:E("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...r,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Zt,{children:e.jsx(_e,{className:"size-4"})})}),e.jsx(es,{children:s})]})}function kr({className:t,...s}){return e.jsx(ts,{"data-slot":"select-scroll-up-button",className:E("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(We,{className:"size-4"})})}function Dr({className:t,...s}){return e.jsx(ss,{"data-slot":"select-scroll-down-button",className:E("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Ce,{className:"size-4"})})}var Rr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ar=Rr.reduce((t,s)=>{const r=Ye(`Primitive.${s}`),a=l.forwardRef((n,o)=>{const{asChild:d,...u}=n,m=d?r:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...u,ref:o})});return a.displayName=`Primitive.${s}`,{...t,[s]:a}},{}),Pr="Label",ft=l.forwardRef((t,s)=>e.jsx(Ar.label,{...t,ref:s,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));ft.displayName=Pr;var Tr=ft;function Z({className:t,...s}){return e.jsx(Tr,{"data-slot":"label",className:E("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}var Lr=Symbol("radix.slottable");function $r(t){const s=({children:r})=>e.jsx(e.Fragment,{children:r});return s.displayName=`${t}.Slottable`,s.__radixId=Lr,s}var pt="AlertDialog",[Mr]=Se(pt,[Fe]),Y=Fe(),bt=t=>{const{__scopeAlertDialog:s,...r}=t,a=Y(s);return e.jsx(rs,{...a,...r,modal:!0})};bt.displayName=pt;var Or="AlertDialogTrigger",zr=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Y(r);return e.jsx(ds,{...n,...a,ref:s})});zr.displayName=Or;var Ir="AlertDialogPortal",vt=t=>{const{__scopeAlertDialog:s,...r}=t,a=Y(s);return e.jsx(is,{...a,...r})};vt.displayName=Ir;var Fr="AlertDialogOverlay",jt=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Y(r);return e.jsx(cs,{...n,...a,ref:s})});jt.displayName=Fr;var ee="AlertDialogContent",[Vr,Br]=Mr(ee),Ur=$r("AlertDialogContent"),yt=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,children:a,...n}=t,o=Y(r),d=l.useRef(null),u=V(s,d),m=l.useRef(null);return e.jsx(as,{contentName:ee,titleName:wt,docsSlug:"alert-dialog",children:e.jsx(Vr,{scope:r,cancelRef:m,children:e.jsxs(ns,{role:"alertdialog",...o,...n,ref:u,onOpenAutoFocus:F(n.onOpenAutoFocus,x=>{x.preventDefault(),m.current?.focus({preventScroll:!0})}),onPointerDownOutside:x=>x.preventDefault(),onInteractOutside:x=>x.preventDefault(),children:[e.jsx(Ur,{children:a}),e.jsx(Wr,{contentRef:d})]})})})});yt.displayName=ee;var wt="AlertDialogTitle",Nt=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Y(r);return e.jsx(os,{...n,...a,ref:s})});Nt.displayName=wt;var St="AlertDialogDescription",Ct=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Y(r);return e.jsx(ls,{...n,...a,ref:s})});Ct.displayName=St;var Hr="AlertDialogAction",_t=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=Y(r);return e.jsx(Ve,{...n,...a,ref:s})});_t.displayName=Hr;var Et="AlertDialogCancel",kt=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,{cancelRef:n}=Br(Et,r),o=Y(r),d=V(s,n);return e.jsx(Ve,{...o,...a,ref:d})});kt.displayName=Et;var Wr=({contentRef:t})=>{const s=`\`${ee}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${ee}\` by passing a \`${St}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${ee}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},qr=bt,Yr=vt,Xr=jt,Gr=yt,Jr=_t,Qr=kt,Kr=Nt,Zr=Ct;function ea({...t}){return e.jsx(qr,{"data-slot":"alert-dialog",...t})}function ta({...t}){return e.jsx(Yr,{"data-slot":"alert-dialog-portal",...t})}function sa({className:t,...s}){return e.jsx(Xr,{"data-slot":"alert-dialog-overlay",className:E("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function ra({className:t,...s}){return e.jsxs(ta,{children:[e.jsx(sa,{}),e.jsx(Gr,{"data-slot":"alert-dialog-content",className:E("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...s})]})}function aa({className:t,...s}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:E("flex flex-col gap-2 text-center sm:text-left",t),...s})}function na({className:t,...s}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:E("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function oa({className:t,...s}){return e.jsx(Kr,{"data-slot":"alert-dialog-title",className:E("text-lg font-semibold",t),...s})}function la({className:t,...s}){return e.jsx(Zr,{"data-slot":"alert-dialog-description",className:E("text-muted-foreground text-sm",t),...s})}function ia({className:t,...s}){return e.jsx(Jr,{className:E(Ee(),t),...s})}function ca({className:t,...s}){return e.jsx(Qr,{className:E(Ee({variant:"outline"}),t),...s})}const da="http://localhost:8000",Dt=`${da}/api/v1`;function ua({sessionId:t,onDiagnosticToggle:s,showDiagnostic:r,onCleaningComplete:a,selectedCount:n=0,onDelete:o,onUndo:d,onReset:u}){const{columns:m,filename:x}=ge(),{downloadDataset:f,downloadAuditReport:p,isLoading:h}=ne(),[b,v]=l.useState(!1),[i,c]=l.useState(!1),[g,j]=l.useState(!1),[N,y]=l.useState(!1),[M,P]=l.useState(!1),k=async()=>{await f(t,x||"dataset")&&console.log("Dataset downloaded successfully")},z=async()=>{await p(t)&&console.log("Audit report downloaded successfully")};return e.jsxs("div",{className:"border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:u&&e.jsxs("button",{onClick:u,className:"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-2 text-sm text-gray-600",title:"Cargar otro archivo o seleccionar otra hoja",children:[e.jsx(zs,{className:"w-4 h-4"}),"📂 Cambiar Archivo/Hoja"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:s,className:`px-4 py-2 rounded-md transition-all flex items-center gap-2 text-sm font-medium ${r?"bg-teal-600 text-white shadow-md":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(we,{className:"w-4 h-4"}),r?"Ocultar Diagnóstico":"Ver Diagnóstico"]}),d&&e.jsxs("button",{onClick:d,className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-2 text-sm text-gray-700",title:"Deshacer último cambio",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Deshacer"]}),e.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-2 text-sm text-gray-700",title:"Gestionar columnas del dataset",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Gestionar Columnas"]}),e.jsxs("button",{onClick:()=>P(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-2 text-sm text-gray-700",title:"Detectar y eliminar filas vacías",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Filas Vacías"]}),e.jsxs("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(Ts,{className:"w-4 h-4"}),"Limpiar Nulos"]}),e.jsxs("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(fe,{className:"w-4 h-4"}),"Eliminar Duplicados"]}),n>0&&o&&e.jsxs("button",{onClick:()=>j(!0),className:"px-4 py-2 bg-red-50 border border-red-200 text-red-700 rounded-md hover:bg-red-100 transition-colors flex items-center gap-2 text-sm font-medium animate-in fade-in",children:[e.jsx(js,{className:"w-4 h-4"}),"Eliminar (",n,")"]}),e.jsx("button",{onClick:k,disabled:h,className:`px-5 py-2.5 rounded-md transition-all flex items-center gap-2 text-sm font-semibold shadow-sm ${h?"bg-teal-400 text-white cursor-not-allowed":"bg-teal-600 text-white hover:bg-teal-700 hover:shadow-md"}`,title:"Descargar dataset limpio en formato Excel",children:h?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 animate-spin"}),"Generando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4"}),"📥 Descargar Excel Final"]})}),e.jsxs("button",{onClick:z,disabled:h,className:`px-4 py-2 rounded-md transition-colors flex items-center gap-2 text-sm font-medium border ${h?"bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,title:"Descargar reporte de auditoría con histórico de cambios",children:[e.jsx(Ms,{className:"w-4 h-4"}),"📄 Reporte de Auditoría"]})]})]}),e.jsx(_r,{isOpen:N,onClose:()=>y(!1),columns:m,sessionId:t,onSuccess:()=>{y(!1),a()}}),e.jsx(Er,{isOpen:M,onClose:()=>P(!1),sessionId:t,onSuccess:()=>{P(!1),a()}}),b&&e.jsx(ma,{sessionId:t,onClose:()=>v(!1),onSuccess:()=>{v(!1),a()}}),i&&e.jsx(xa,{sessionId:t,onClose:()=>c(!1),onSuccess:()=>{c(!1),a()}}),e.jsx(ea,{open:g,onOpenChange:j,children:e.jsxs(ra,{children:[e.jsxs(aa,{children:[e.jsx(oa,{children:"¿Estás seguro?"}),e.jsx(la,{children:"¿Estás seguro de eliminar estas filas? La acción no se puede deshacer."})]}),e.jsxs(na,{children:[e.jsx(ca,{children:"Cancelar"}),e.jsx(ia,{onClick:()=>{j(!1),o&&o()},className:"bg-red-600 hover:bg-red-700 text-white",children:"Eliminar Filas"})]})]})})]})}function ma({sessionId:t,onClose:s,onSuccess:r}){const{healthReport:a}=ge(),[n,o]=l.useState(""),[d,u]=l.useState("mean"),[m,x]=l.useState(!1),f=a?Object.values(a.columns).filter(h=>h.missing_count>0):[],p=async()=>{if(!n){alert("Por favor selecciona una columna");return}x(!0);try{const h=await fetch(`${Dt}/cleaning/nulls`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,column:n,method:d})});if(h.ok)r();else{const b=await h.json();alert(b.message||"Error al limpiar nulos")}}catch{alert("Error de conexión")}finally{x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Limpiar Valores Nulos"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"Columna"}),e.jsxs(ue,{value:n,onValueChange:o,children:[e.jsx(xe,{children:e.jsx(me,{placeholder:"Selecciona una columna"})}),e.jsx(he,{children:f.length>0?f.map(h=>e.jsxs($,{value:h.column_name,children:[h.column_name," (",h.missing_count," nulos)"]},h.column_name)):e.jsx("div",{className:"p-2 text-sm text-gray-500 text-center",children:"No hay columnas con valores nulos"})})]}),f.length===0&&e.jsx("p",{className:"text-xs text-green-600",children:"¡Tus datos están completos! No se encontraron valores nulos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"Método"}),e.jsxs(ue,{value:d,onValueChange:h=>u(h),children:[e.jsx(xe,{children:e.jsx(me,{placeholder:"Selecciona método"})}),e.jsxs(he,{children:[e.jsx($,{value:"mean",children:"Media (numérico)"}),e.jsx($,{value:"median",children:"Mediana (numérico)"}),e.jsx($,{value:"mode",children:"Moda (más frecuente)"}),e.jsx($,{value:"drop",children:"Eliminar filas"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-6",children:[e.jsx(A,{variant:"outline",onClick:s,className:"flex-1",children:"Cancelar"}),e.jsxs(A,{onClick:p,disabled:m||!n,className:"flex-1 bg-teal-600 hover:bg-teal-700 text-white",children:[m?e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Aplicar"]})]})]})})}function xa({sessionId:t,onClose:s,onSuccess:r}){const[a,n]=l.useState(!1),o=async()=>{n(!0);try{const d=await fetch(`${Dt}/cleaning/duplicates`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,keep:"first"})});if(d.ok){const u=await d.json();alert(`¡Éxito! Se eliminaron ${u.duplicates_removed} filas duplicadas`),r()}else{const u=await d.json();alert(u.message||"Error al eliminar duplicados")}}catch{alert("Error de conexión")}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Eliminar Duplicados"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Se eliminarán todas las filas duplicadas del dataset, manteniendo la primera ocurrencia."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{variant:"outline",onClick:s,className:"flex-1",children:"Cancelar"}),e.jsxs(A,{onClick:o,disabled:a,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[a?e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Confirmar"]})]})]})})}function ha({column:t}){const r={critical:{bg:"bg-red-50",border:"border-red-300",badge:"bg-red-600",text:"text-red-700",icon:te,label:"Crítico"},warning:{bg:"bg-amber-50",border:"border-amber-300",badge:"bg-amber-500",text:"text-amber-700",icon:K,label:"Advertencia"},info:{bg:"bg-blue-50",border:"border-blue-300",badge:"bg-blue-500",text:"text-blue-700",icon:He,label:"Info"},ok:{bg:"bg-green-50",border:"border-green-300",badge:"bg-green-600",text:"text-green-700",icon:ks,label:"OK"}}[t.status],a=r.icon;return e.jsxs("div",{className:`rounded-lg border-2 ${r.border} ${r.bg} p-4 transition-all hover:shadow-md`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:t.column_name}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:t.data_type})]}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-full ${r.badge} text-white text-xs font-medium`,children:[e.jsx(a,{className:"w-3 h-3"}),e.jsx("span",{children:r.label})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Completitud"}),e.jsxs("span",{className:"font-medium",children:[t.completeness.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${t.completeness>=90?"bg-green-500":t.completeness>=70?"bg-amber-500":"bg-red-500"}`,style:{width:`${t.completeness}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3 text-xs",children:[e.jsxs("div",{className:"bg-white/60 rounded px-2 py-1.5",children:[e.jsx("div",{className:"text-gray-500",children:"Únicos"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.unique_count.toLocaleString()})]}),e.jsxs("div",{className:"bg-white/60 rounded px-2 py-1.5",children:[e.jsx("div",{className:"text-gray-500",children:"Nulos"}),e.jsx("div",{className:"font-medium text-red-600",children:t.missing_count.toLocaleString()})]})]}),t.min_value!==null&&t.min_value!==void 0&&e.jsxs("div",{className:"bg-white/60 rounded px-2 py-1.5 mb-2 text-xs",children:[e.jsx("div",{className:"text-gray-500 mb-0.5",children:"Rango"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[t.min_value.toFixed(2)," → ",t.max_value?.toFixed(2)]})]}),t.outlier_count>0&&e.jsxs("div",{className:`flex items-center gap-1.5 text-xs ${r.text} mb-2`,children:[e.jsx(K,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[t.outlier_count," outliers detectados"]})]}),t.inconsistency_count>0&&e.jsxs("div",{className:`flex items-center gap-1.5 text-xs ${r.text} mb-2`,children:[e.jsx(te,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[t.inconsistency_count," inconsistencias de tipo"]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("p",{className:`text-xs ${r.text} font-medium`,children:["💡 ",t.suggestion]})})]})}function ga({report:t}){const[s,r]=l.useState(!0),a=l.useMemo(()=>Object.values(t.columns),[t.columns]),o=(d=>d>=90?"text-green-600 bg-green-50 border-green-200":d>=70?"text-amber-600 bg-amber-50 border-amber-200":"text-red-600 bg-red-50 border-red-200")(t.overall_completeness);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 mb-4",children:[e.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Diagnóstico de Salud del Dataset"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Análisis inteligente de calidad de datos"})]})]}),e.jsxs("button",{onClick:()=>r(!s),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md transition-colors",children:[s?"Contraer":"Expandir",s?e.jsx(We,{className:"w-4 h-4"}):e.jsx(Ce,{className:"w-4 h-4"})]})]})}),s&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Total Registros"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:t.total_rows.toLocaleString()}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:[t.total_columns," columnas"]})]}),e.jsxs("div",{className:`border-2 rounded-lg p-4 ${o}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Salud Global"})]}),e.jsxs("div",{className:"text-3xl font-bold",children:[t.overall_completeness.toFixed(1),"%"]}),e.jsx("div",{className:"w-full bg-white/50 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.overall_completeness>=90?"bg-green-600":t.overall_completeness>=70?"bg-amber-600":"bg-red-600"}`,style:{width:`${t.overall_completeness}%`}})})]}),e.jsxs("div",{className:`border-2 rounded-lg p-4 ${t.total_anomalies>0?"bg-red-50 border-red-200 text-red-900":"bg-green-50 border-green-200 text-green-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Anomalías"})]}),e.jsx("div",{className:"text-3xl font-bold",children:t.total_anomalies.toLocaleString()}),e.jsx("div",{className:"text-xs mt-1",children:t.total_anomalies>0?"Outliers (IQR)":"Sin outliers"})]}),e.jsxs("div",{className:`border-2 rounded-lg p-4 ${t.duplicate_rows+t.total_inconsistencies>0?"bg-amber-50 border-amber-200 text-amber-900":"bg-green-50 border-green-200 text-green-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Problemas"})]}),e.jsx("div",{className:"text-3xl font-bold",children:(t.duplicate_rows+t.total_inconsistencies).toLocaleString()}),e.jsxs("div",{className:"text-xs mt-1",children:[t.duplicate_rows," duplicados, ",t.total_inconsistencies," inconsistencias"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-teal-600 rounded"}),"Análisis por Columna (",a.length," columnas)"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:a.map(d=>e.jsx(ha,{column:d},d.column_name))})]})]})]})}function fa({isOpen:t,initialValue:s,columnName:r,issueType:a,onSave:n,onClose:o,bounds:d}){const[u,m]=l.useState("");l.useEffect(()=>{m(s==null?"":String(s))},[s,t]);const x=()=>{let h=u;u===""?h=null:!isNaN(Number(u))&&u.trim()!==""&&(h=Number(u)),n(h),o()},p=(()=>{switch(a){case"outlier":return{icon:e.jsx(K,{className:"h-5 w-5 text-orange-500"}),title:"Valor Atípico (Outlier)",description:d?`Este valor está fuera del rango esperado (${d.lower.toFixed(2)} - ${d.upper.toFixed(2)}).`:"Este valor se desvía significativamente de la distribución de la columna.",color:"text-orange-700 bg-orange-50 border-orange-200"};case"null":return{icon:e.jsx(te,{className:"h-5 w-5 text-red-500"}),title:"Valor Vacío",description:"Esta celda no contiene datos. Los valores nulos pueden afectar los cálculos estadísticos.",color:"text-red-700 bg-red-50 border-red-200"};case"duplicate":return{icon:e.jsx(fe,{className:"h-5 w-5 text-amber-500"}),title:"Fila Duplicada",description:"Esta fila es idéntica a otra en el conjunto de datos. Considere eliminar o modificar los duplicados.",color:"text-amber-700 bg-amber-50 border-amber-200"};default:return{icon:e.jsx(He,{className:"h-5 w-5 text-gray-500"}),title:"Editar Celda",description:"Modifique el valor de esta celda.",color:"text-gray-700 bg-gray-50 border-gray-200"}}})();return e.jsx(ms,{open:t,onOpenChange:h=>!h&&o(),children:e.jsxs(xs,{className:"sm:max-w-[425px]",children:[e.jsxs(hs,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p.icon,e.jsx(gs,{children:p.title})]}),e.jsxs(fs,{children:["Columna: ",e.jsx("span",{className:"font-medium text-foreground",children:r})]})]}),e.jsx("div",{className:`p-3 rounded-md border text-sm mb-4 ${p.color}`,children:p.description}),e.jsx("div",{className:"grid gap-4 py-2",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"cell-value",className:"text-right",children:"Valor"}),e.jsx(ke,{id:"cell-value",value:u,onChange:h=>m(h.target.value),className:"col-span-3",autoFocus:!0})]})}),e.jsxs(ps,{children:[e.jsx(A,{variant:"outline",onClick:o,children:"Cancelar"}),e.jsx(A,{onClick:x,children:"Guardar Cambios"})]})]})})}function pa({sessionId:t,columnsWithNulls:s,onClose:r,onApply:a}){const{simulateNullCleaning:n,cleanNulls:o,isLoading:d}=ne(),[u,m]=l.useState(""),[x,f]=l.useState("mean"),[p,h]=l.useState(""),[b,v]=l.useState(null),[i,c]=l.useState(null),g=async()=>{if(!u){c("Por favor selecciona una columna");return}c(null);const y=await n({session_id:t,column:u,method:x,fill_value:p||void 0});y?v(y):c("Error al simular la limpieza")},j=async()=>{if(!u)return;await o({session_id:t,column:u,method:x,fill_value:p||void 0})&&(v(null),m(""),h(""),a())},N=x==="constant"||x==="custom_value";return e.jsxs("div",{className:"w-80 border-l border-gray-200 bg-gray-50 flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-teal-600"}),"Gestionar Nulos"]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-sm font-medium text-gray-700",children:"Columna"}),e.jsxs(ue,{value:u,onValueChange:m,children:[e.jsx(xe,{className:"bg-white",children:e.jsx(me,{placeholder:"Selecciona una columna"})}),e.jsx(he,{children:s.length>0?s.map(y=>e.jsxs($,{value:y.column_name,children:[y.column_name," (",y.missing_count," nulos)"]},y.column_name)):e.jsx("div",{className:"p-2 text-sm text-gray-500 text-center",children:"No hay columnas con valores nulos"})})]}),s.length===0&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),"¡Tus datos están completos!"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-sm font-medium text-gray-700",children:"Método de Imputación"}),e.jsxs(ue,{value:x,onValueChange:y=>f(y),children:[e.jsx(xe,{className:"bg-white",children:e.jsx(me,{})}),e.jsxs(he,{children:[e.jsx($,{value:"mean",children:"Media (numérico)"}),e.jsx($,{value:"median",children:"Mediana (numérico)"}),e.jsx($,{value:"mode",children:"Moda (más frecuente)"}),e.jsx($,{value:"ffill",children:"Forward Fill (time-series)"}),e.jsx($,{value:"bfill",children:"Backward Fill (time-series)"}),e.jsx($,{value:"custom_value",children:"Valor Personalizado"}),e.jsx($,{value:"date_interpolation",children:"Interpolación (fechas)"}),e.jsx($,{value:"drop",children:"Eliminar Filas"})]})]})]}),N&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-sm font-medium text-gray-700",children:"Valor de Relleno"}),e.jsx(ke,{type:"text",value:p,onChange:y=>h(y.target.value),placeholder:"Ingresa el valor...",className:"bg-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Acepta texto, números enteros o decimales"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(A,{onClick:g,disabled:d||!u||N&&!p,className:"w-full bg-blue-600 hover:bg-blue-700 text-white gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 animate-spin"}),"Simulando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),"🧪 Simular Impacto"]})})}),i&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md text-sm text-red-700",children:i}),b&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[e.jsx(K,{className:"w-4 h-4 text-amber-500"}),"Impacto Estimado"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Filas afectadas:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:b.rows_affected})]}),b.information_loss_percent>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Pérdida de datos:"}),e.jsxs("span",{className:"font-semibold text-red-600 flex items-center gap-1",children:[e.jsx(Us,{className:"w-3 h-3"}),b.information_loss_percent.toFixed(1),"%"]})]}),b.distribution_change&&e.jsxs("div",{className:"pt-2 border-t border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Cambio estadístico:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Media:"}),e.jsxs("div",{className:"font-mono",children:[e.jsx("span",{className:"text-gray-400",children:b.distribution_change.mean_before?.toFixed(2)})," → ",e.jsx("span",{className:"text-teal-600 font-semibold",children:b.distribution_change.mean_after?.toFixed(2)})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Desv. Est.:"}),e.jsxs("div",{className:"font-mono",children:[e.jsx("span",{className:"text-gray-400",children:b.distribution_change.std_before?.toFixed(2)})," → ",e.jsx("span",{className:"text-teal-600 font-semibold",children:b.distribution_change.std_after?.toFixed(2)})]})]})]})]})]})]}),b.sample_preview.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:["Vista Previa (primeras ",b.sample_preview.length," filas)"]}),e.jsx("div",{className:"space-y-2",children:b.sample_preview.map((y,M)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("span",{className:"text-gray-500",children:["Fila ",y.row_index+1,":"]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"font-mono text-gray-400 line-through",children:y.value_before===null?"null":String(y.value_before)}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{className:"font-mono text-teal-600 font-semibold",children:y.value_after===null?"null":String(y.value_after)})]})]},M))})]}),e.jsxs(A,{onClick:j,disabled:d,className:"w-full bg-teal-600 hover:bg-teal-700 text-white gap-2",children:[d?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(ye,{className:"w-4 h-4"}),"✅ Aplicar Limpieza"]})]})]})]})}const W=50;function ba({sessionId:t,onReset:s}){const{data:r,columns:a,totalRows:n,isLoading:o,error:d,refreshData:u,healthReport:m,refreshHealthReport:x,setData:f}=ge(),{deleteRows:p,undoLastChange:h}=ne(),[b,v]=l.useState("summary"),[i,c]=l.useState(1),[g,j]=l.useState(!1),[N,y]=l.useState(null),[M,P]=l.useState(!1),[k,z]=l.useState(new Set);l.useEffect(()=>{t&&(c(1),v("summary"),u(0,15),x())},[t]),l.useEffect(()=>{if(!t)return;const w=b==="summary"?15:W,S=b==="summary"?0:(i-1)*W;u(S,w),z(new Set)},[b,i,t]),l.useEffect(()=>{m&&(m.overall_completeness<80||m.total_anomalies>0)&&j(!0)},[m]);const C=()=>{const w=b==="summary"?15:W,S=b==="summary"?0:(i-1)*W;u(S,w),x(),z(new Set)},T=l.useMemo(()=>new Set(m?.duplicate_rows_indices||[]),[m?.duplicate_rows_indices]),U=l.useCallback((w,S,D)=>{if(w==null||w==="")return{type:"null",colorClass:"bg-red-50 hover:bg-red-100/50",icon:e.jsx(te,{className:"w-3 h-3 text-red-400 absolute top-1 right-1"})};if(!m)return{type:"normal",colorClass:""};if(T.has(S))return{type:"duplicate",colorClass:"bg-amber-50 hover:bg-amber-100/50",icon:e.jsx(fe,{className:"w-3 h-3 text-amber-400 absolute top-1 right-1"})};const L=m.columns[D];if(L&&L.outlier_bounds){const _=Number(w);if(!isNaN(_)){const{lower:J,upper:H}=L.outlier_bounds;if(_<J||_>H)return{type:"outlier",colorClass:"bg-orange-50 hover:bg-orange-100/50",icon:e.jsx(K,{className:"w-3 h-3 text-orange-400 absolute top-1 right-1"}),bounds:{lower:J,upper:H}}}}return{type:"normal",colorClass:""}},[m,T]),Te=(w,S,D)=>{const L=b==="summary"?S:(i-1)*W+S,_=U(w[D],L,D);y({rowIndex:S,columnName:D,value:w[D],issueType:_.type,bounds:_.bounds})},Rt=w=>{if(!N)return;const S=[...r];S[N.rowIndex]&&(S[N.rowIndex]={...S[N.rowIndex],[N.columnName]:w},f(S))},At=w=>{const S=new Set(k);S.has(w)?S.delete(w):S.add(w),z(S)},Pt=()=>{const w=new Set(k),S=b==="summary"?0:(i-1)*W;r.every((L,_)=>w.has(S+_))?r.forEach((L,_)=>w.delete(S+_)):r.forEach((L,_)=>w.add(S+_)),z(w)},Tt=async()=>{if(k.size===0)return;const w=Array.from(k),S=await p({session_id:t,row_indices:w});S&&S.success&&C()},Lt=async()=>{await h(t)&&C()},$t=l.useMemo(()=>m?Object.values(m.columns).filter(w=>w.missing_count>0):[],[m]),Le=l.useMemo(()=>{if(b==="full"||!m)return a;const w=Object.keys(m.columns).filter(L=>{const _=m.columns[L];return _.outlier_count>0||_.inconsistency_count>0||_.missing_count>0}),S=a.slice(0,5),D=Array.from(new Set([...S,...w]));return a.filter(L=>D.includes(L))},[a,b,m]),je=Math.ceil(n/W),Mt=r.length>0&&r.every((w,S)=>{const D=b==="summary"?S:(i-1)*W+S;return k.has(D)});return o&&r.length===0?e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(q,{className:"w-8 h-8 text-teal-600 animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos..."})]})}):d?e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 max-w-md text-center",children:[e.jsx(te,{className:"w-8 h-8 text-red-600"}),e.jsx("p",{className:"text-red-600 font-medium",children:d}),e.jsx(A,{variant:"outline",onClick:()=>u(),children:"Reintentar"})]})}):e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[g&&m&&e.jsx(ga,{report:m}),e.jsxs("div",{className:"flex h-full gap-0",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 flex flex-col shadow-sm flex-1 overflow-hidden",children:[e.jsx(ua,{sessionId:t,onDiagnosticToggle:()=>j(!g),showDiagnostic:g,onCleaningComplete:C,selectedCount:k.size,onDelete:Tt,onUndo:Lt,onReset:s}),e.jsxs("div",{className:"border-b border-gray-200 px-4 py-2 bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["Filas: ",e.jsx("strong",{className:"text-gray-900",children:n.toLocaleString()})]}),e.jsxs("span",{children:["Cols: ",e.jsx("strong",{className:"text-gray-900",children:a.length})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-400"}),"Outliers: ",e.jsx("strong",{children:m.total_anomalies})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-400"}),"Duplicados: ",e.jsx("strong",{children:m.duplicate_rows})]})]}),k.size>0&&e.jsxs("span",{className:"ml-4 px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full font-medium",children:[k.size," seleccionada(s)"]})]}),b==="full"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Página ",i," de ",je||1]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(A,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>c(w=>Math.max(1,w-1)),disabled:i===1||o,children:e.jsx(Cs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>c(w=>Math.min(je,w+1)),disabled:i>=je||o,children:e.jsx(bs,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto relative",children:[o&&e.jsx("div",{className:"absolute inset-0 bg-white/50 z-10 flex items-center justify-center",children:e.jsx(q,{className:"w-8 h-8 text-teal-600 animate-spin"})}),e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border-b border-r border-gray-200 w-10 text-center bg-gray-50",children:e.jsx(de,{checked:Mt,onCheckedChange:Pt})}),e.jsx("th",{className:"px-3 py-2 border-b border-r border-gray-200 w-10 text-center bg-gray-50 text-gray-400 font-normal",children:"#"}),Le.map(w=>e.jsx("th",{className:"text-left px-3 py-2 text-xs font-semibold text-gray-600 border-b border-r border-gray-200 whitespace-nowrap bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-1",children:[w,m?.columns[w]?.status==="warning"&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500"})]})},w))]})}),e.jsx("tbody",{className:"bg-white",children:r.map((w,S)=>{const D=b==="summary"?S:(i-1)*W+S,L=m?.duplicate_rows_indices.includes(D),_=k.has(D);return e.jsxs("tr",{className:`group ${_?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-3 py-2 border-b border-r border-gray-100 text-center bg-gray-50/30",children:e.jsx(de,{checked:_,onCheckedChange:()=>At(D)})}),e.jsx("td",{className:"px-3 py-2 border-b border-r border-gray-100 text-xs text-center text-gray-400 bg-gray-50/50",children:D+1}),Le.map(J=>{const H=w[J],oe=U(H,D,J);return e.jsxs("td",{onClick:()=>Te(w,S,J),className:`
                             px-3 py-2 border-b border-r border-gray-100 relative cursor-pointer transition-colors
                             text-gray-700 font-mono text-xs
                             ${oe.colorClass}
                             ${!oe.colorClass&&!_&&"hover:bg-blue-50/50"}
                             ${!oe.colorClass&&L&&!_?"bg-amber-50/30":""}
                          `,children:[e.jsx("span",{className:"block truncate max-w-[200px]",title:String(H),children:H==null||H===""?e.jsx("span",{className:"text-gray-300 italic",children:"null"}):String(H)}),oe.icon]},J)})]},S)})})]}),r.length===0&&!o&&e.jsx("div",{className:"flex flex-col items-center justify-center h-40 text-gray-500",children:e.jsx("p",{children:"No se encontraron datos para mostrar."})})]}),b==="summary"&&n>15&&e.jsxs("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex flex-col items-center justify-center gap-2",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Mostrando vista previa de 15 filas. El conjunto de datos completo tiene ",n," filas."]}),e.jsxs(A,{onClick:()=>{v("full"),c(1)},className:"bg-teal-600 hover:bg-teal-700 text-white gap-2",children:[e.jsx(us,{className:"w-4 h-4"}),"Explorar y Limpiar Datos Completos"]})]})]}),M&&e.jsx(pa,{sessionId:t,columnsWithNulls:$t,onClose:()=>P(!1),onApply:()=>{P(!1),C()}})]}),N&&e.jsx(fa,{isOpen:!0,initialValue:N.value,columnName:N.columnName,issueType:N.issueType,bounds:N.bounds,onClose:()=>y(null),onSave:Rt})]})}function va(){return e.jsxs("div",{className:"h-12 bg-white border-t border-gray-200 px-6 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-6 text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Filas:"}),e.jsx("span",{className:"text-gray-900",children:"150"})]}),e.jsx("div",{className:"w-px h-4 bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Columnas:"}),e.jsx("span",{className:"text-gray-900",children:"12"})]}),e.jsx("div",{className:"w-px h-4 bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ye,{className:"w-4 h-4 text-teal-600"}),e.jsx("span",{className:"text-teal-700",children:"Listo"})]})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Última modificación: Hoy, 14:32"})]})}const ja="http://localhost:8000",ya=`${ja}/api/v1`;function wa({sheets:t,filename:s,tempId:r,onConfirm:a,onCancel:n}){const[o,d]=l.useState(()=>{const c=t.find(g=>g.is_suggested);return c?[c.sheet_name]:[]}),[u,m]=l.useState(!1),[x,f]=l.useState(!1),[p,h]=l.useState(null),b=l.useRef(!1),v=c=>{d(g=>g.includes(c)?g.filter(j=>j!==c):[...g,c])},i=async()=>{if(b.current){console.log("[SheetSelectionModal] Duplicate submission blocked");return}if(b.current=!0,o.length===0){h("Debes seleccionar al menos una pestaña"),b.current=!1;return}f(!0),h(null);try{console.log("[SheetSelectionModal] Submitting sheet selection:",{temp_id:r,selected_sheets:o,merge:u&&o.length>1});const c=await fetch(`${ya}/upload/select-sheets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({temp_id:r,selected_sheets:o,merge:u&&o.length>1})});if(!c.ok){const j=await c.json();throw new Error(j.detail||j.message||"Error al procesar las pestañas")}const g=await c.json();if(console.log("[SheetSelectionModal] Sheet selection successful:",g),g.session_id){const j=g.metadata?.column_names||[];a(g.session_id,j)}else throw new Error("No se recibió session_id del servidor")}catch(c){b.current=!1;const g=c instanceof Error?c.message:"Error desconocido";h(g),console.error("[SheetSelectionModal] Sheet selection error:",c)}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Seleccionar Pestañas"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["El archivo ",e.jsx("strong",{children:s})," contiene ",t.length," pestañas. Selecciona las que deseas importar."]})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:x,children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:t.map(c=>{const g=o.includes(c.sheet_name);return e.jsxs("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-all ${g?"border-teal-500 bg-teal-50":"border-gray-200 hover:border-gray-300 bg-white"}`,onClick:()=>v(c.sheet_name),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-teal-600"}),e.jsx("h3",{className:"font-medium text-gray-900",children:c.sheet_name}),c.is_suggested&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-medium",children:"Recomendada"})]}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${g?"border-teal-500 bg-teal-500":"border-gray-300"}`,children:g&&e.jsx(_e,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("span",{children:[c.rows.toLocaleString()," filas"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[c.columns," columnas"]}),c.missing_count>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-amber-600",children:[c.missing_count," nulos"]})]})]}),c.preview_data&&c.preview_data.length>0&&e.jsx("div",{className:"border border-gray-200 rounded overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[c.column_names.slice(0,4).map(j=>e.jsx("th",{className:"px-2 py-1.5 text-left text-gray-600 font-medium",children:j},j)),c.column_names.length>4&&e.jsx("th",{className:"px-2 py-1.5 text-left text-gray-400",children:"..."})]})}),e.jsx("tbody",{children:c.preview_data.slice(0,3).map((j,N)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[c.column_names.slice(0,4).map(y=>e.jsx("td",{className:"px-2 py-1.5 text-gray-700",children:j[y]!==null&&j[y]!==void 0?String(j[y]).substring(0,20):e.jsx("span",{className:"text-red-600",children:"NULL"})},y)),c.column_names.length>4&&e.jsx("td",{className:"px-2 py-1.5 text-gray-400",children:"..."})]},N))})]})})]},c.sheet_name)})})}),e.jsxs("div",{className:"border-t border-gray-200 p-6 bg-gray-50",children:[o.length>1&&e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"merge",checked:u,onChange:c=>m(c.target.checked),className:"rounded border-gray-300 text-teal-600 focus:ring-teal-500"}),e.jsx("label",{htmlFor:"merge",className:"text-sm text-gray-700 cursor-pointer",children:"Combinar pestañas seleccionadas (concatenar verticalmente)"})]}),p&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 px-4 py-2 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(te,{className:"w-4 h-4 text-red-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700",children:p})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[o.length," pestaña",o.length!==1&&"s"," seleccionada",o.length!==1&&"s"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,disabled:x,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:i,disabled:x||o.length===0,className:`px-5 py-2 rounded-md transition-colors text-white ${x||o.length===0?"bg-gray-400 cursor-not-allowed":"bg-teal-600 hover:bg-teal-700"}`,children:x?"Procesando...":"Confirmar Selección"})]})]})]})]})})}function Da(){const{sessionId:t,setSessionId:s,setColumns:r}=ge(),[a,n]=l.useState(!1),[o,d]=l.useState(null),[u,m]=l.useState([]),[x,f]=l.useState(""),p=i=>{i.status==="ready"?(s(i.session_id),i.metadata?.column_names&&(r(i.metadata.column_names),console.log("[DataPreprocessing] Columns saved:",i.metadata.column_names)),console.log("[DataPreprocessing] File uploaded successfully:",i.filename)):i.status==="selection_required"&&(d(i.temp_id),m(i.sheets),f(i.filename),n(!0),console.log(`[DataPreprocessing] File has ${i.total_sheets} sheets, showing selection modal`))},h=(i,c)=>{console.log("[DataPreprocessing] Sheet selection confirmed, session ID:",i),s(i),c&&c.length>0&&(r(c),console.log("[DataPreprocessing] Columns saved from sheet selection:",c)),n(!1),d(null),m([]),f("")},b=()=>{console.log("[DataPreprocessing] Sheet selection cancelled"),n(!1),d(null),m([]),f("")},v=()=>{window.confirm("¿Quieres cargar otro archivo? Se perderán los cambios actuales no guardados.")&&(console.log("[DataPreprocessing] Resetting session - returning to upload"),s(null),d(null),f(""),m([]))};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 p-6 space-y-4",children:t?e.jsx(ba,{sessionId:t,onReset:v}):e.jsx(Js,{onUploadSuccess:p})}),e.jsx(va,{}),a&&o&&e.jsx(wa,{sheets:u,filename:x,tempId:o,onConfirm:h,onCancel:b})]})}export{Da as DataPreprocessing};
